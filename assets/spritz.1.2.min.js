if("undefined"==typeof jQuery)throw new Error("Spritz's JavaScript requires jQuery");if(function(a){var b=a("#spritzjs");if(0===b.length)window.spritz_sdk_root="http://sdk.spritzinc.com/js/1.2";else{var c=b.attr("src"),d=c.split("/"),e="";if(d.length<3)e=".";else for(var f=0;f<d.length-2;f++)e+=d[f],e+="/";window.spritz_sdk_root=e}}(jQuery),!document.getElementById("spritz-css")){var head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.id="spritz-css",link.rel="stylesheet",link.type="text/css",link.href=window.spritz_sdk_root,"/"!==link.href.substring(link.href.length-1)&&(link.href+="/"),link.href="assets/spritz.min.css",link.media="all",head.appendChild(link)}jQuery(document).ready(function(){"SpritzSettings"in window&&"object"==typeof window.SpritzSettings&&"object"==typeof window.SpritzClient&&window.SpritzSettings.hasOwnProperty("clientId")&&"object"==typeof SPRITZ&&"object"==typeof SPRITZ.spritzinc&&SPRITZ.spritzinc.initSpritzers(window.SpritzClient)}),jQuery(document).on("spritz_loaded_internal",function(){if("SpritzSettings"in window&&"object"==typeof window.SpritzSettings)if(window.SpritzSettings.hasOwnProperty("clientId")){var a="https://api.spritzinc.com/api-server/v1/",b=location.href;window.SpritzSettings.hasOwnProperty("apiRoot")&&(a=window.SpritzSettings.apiRoot),window.SpritzSettings.hasOwnProperty("redirectUri")&&(b=window.SpritzSettings.redirectUri),"object"==typeof SPRITZ&&"object"==typeof SPRITZ.client&&(window.SpritzClient=new SPRITZ.client.SpritzClient(window.SpritzSettings.clientId,a,b),window.SpritzSettings.hasOwnProperty("anonymousEnabled")&&"boolean"==typeof window.SpritzSettings.anonymousEnabled&&window.SpritzClient.setAnonymousEnabled(window.SpritzSettings.anonymousEnabled),jQuery.isReady&&"object"==typeof SPRITZ.spritzinc&&SPRITZ.spritzinc.initSpritzers(window.SpritzClient))}else console&&console.log("SpritzSettings is missing clientId property, skipping initialization")});var SPRITZ=SPRITZ||{};SPRITZ.utils={},SPRITZ.utils.debugLevel=0,SPRITZ.utils.setDebugLevel=function(a){SPRITZ.utils.debugLevel=a},SPRITZ.namespace=function(a){var b,c=a.split("."),d=SPRITZ;for("SPRITZ"===c[0]&&(c=c.slice(1)),b=0;b<c.length;b+=1)"undefined"==typeof d[c[b]]&&(d[c[b]]={}),d=d[c[b]];return d},SPRITZ.addToNamespace=function(a,b){var c=b();for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])},SPRITZ.utils.supportsCanvas=function(){return!!document.createElement("canvas").getContext()},SPRITZ.utils.supportsCanvasText=function(){if(!SPRITZ.utils.supportsCanvas())return!1;var a=document.createElement("canvas"),b=a.getContext("2d");return"function"==typeof b.fillText},SPRITZ.utils.supportsHtmlStorage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},SPRITZ.utils.endsWith=function(a,b){return-1!==a.indexOf(b,a.length-b.length)},SPRITZ.utils.timestampToString=function(a,b){"undefined"==typeof b&&(b=new Date);var c="",d=Math.round((b.getTime()-a)/1e3);if(60>d)c=d+"s ago";else{var e=Math.round((b.getTime()-a)/6e4);if(60>e)c=e+"m ago";else{var f,g,h=new Date(a);h.getHours()>12?(f=h.getHours()-12,g="PM"):(f=h.getHours(),g="AM");var i=f+":";h.getMinutes()<10&&(i+="0"),i=i+h.getMinutes()+" "+g,c=h.getDate()===b.getDate()&&h.getMonth()===b.getMonth()&&h.getFullYear()===b.getFullYear()?i:h.getMonth()+1+"/"+h.getDate()+"/"+h.getFullYear().toString().substring(2,4)+" "+i}}return c},SPRITZ.utils.timeToString=function(a){var b,c=Math.round(a/1e3),d=c/60;if(d>=60){var e=Math.floor(d/60);d=Math.round(d%60),b=e+"hr"+(e>1?"s ":" ")+d+"m"}else d=Math.floor(d),c=Math.round(c%60),b=(d>0?d+"m ":"")+c+"s";return b};var jsutil=jsutil||function(){var a=null,b=200,c=220,d=function(a,b){if("function"!=typeof b)throw new Error("method parameter is not a function ["+typeof b+"]");var c=function(){return b.apply(a,arguments)};return c},e=function(d,e){if("undefined"==typeof e&&(e=d,d=0),console&&d<=SPRITZ.utils.debugLevel&&console.log(e),null===a&&(a=jQuery("#spritzDebugPage .ui-page-content"),0===a.length&&(a=null)),a&&d<=SPRITZ.utils.debugLevel){var f;switch(d){case 1:f="dbg-err";break;case 2:f="dbg-warn";break;case 3:f="dbg-3";break;case 4:f="dbg-4";break;case 5:f="dbg-5";break;default:f="dbg-info"}jQuery('<div class="'+f+'">'+e+"</div>").appendTo(a);var g=a.children("div");if(g.length>c){for(var h=g.length-b,i=h-1;i>=0;i--)g[i].remove();jQuery('<div class="dbg-info;">'+(new Date).toString()+" - Removed "+h+" entries</div>").appendTo(a)}}};return{createDelegate:d,debug:e}}();+function(a){function b(b){a(d).remove(),a(e).each(function(){var d=c(a(this)),e={relatedTarget:this};d.hasClass(f)&&(d.trigger(b=a.Event("hide.bs.dropdown",e)),b.isDefaultPrevented()||d.removeClass(f).trigger("hidden.bs.dropdown",e))})}function c(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}var d=".spritzer-dropdown-backdrop",e="[data-toggle=spritz-dropdown]",f="spritzer-open",g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var g=c(e),h=g.hasClass(f);if(b(),!h){"ontouchstart"in document.documentElement&&!g.closest(".navbar-nav").length&&a('<div class="spritzer-dropdown-backdrop"/>').insertAfter(a(this)).on("click",b);var i={relatedTarget:this};if(g.trigger(d=a.Event("show.bs.dropdown",i)),d.isDefaultPrevented())return;g.toggleClass(f).trigger("shown.bs.dropdown",i),e.focus()}return!1}},g.prototype.keydown=function(b){if(/(38|40|27)/.test(b.keyCode)){var d=a(this);if(b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled")){var g=c(d),h=g.hasClass(f);if(!h||h&&27==b.keyCode)return 27==b.which&&g.find(e).focus(),d.click();var i=" li:not(.divider):visible a",j=g.find("[role=menu]"+i+", [role=listbox]"+i);if(j.length){var k=j.index(j.filter(":focus"));38==b.keyCode&&k>0&&k--,40==b.keyCode&&k<j.length-1&&k++,~k||(k=0),j.eq(k).focus()}}}};var h=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})},a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",b).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",e,g.prototype.toggle).on("keydown.bs.dropdown.data-api",e+", [role=menu], [role=listbox]",g.prototype.keydown)}(jQuery),SPRITZ.namespace("SPRITZ.component"),SPRITZ.addToNamespace(SPRITZ.component,function(){function a(a){this.container=a instanceof jQuery?a:c(a),a.data("controller",this),this.button=c(".spritzer-wpm-btn",this.container),this.currentValue=null,b.call(this)}function b(){c(d,this.container).on("click","li",jsutil.createDelegate(this,e))}var c=jQuery,d=".spritzer-dropdown-menu",e=function(a){a.preventDefault();var b=c(a.currentTarget),d=b.data("value");!b.hasClass("spritzer-disabled")&&d&&(g.call(this,b),f.call(this,d))},f=function(a,b){if(this.currentValue==a);else{var c=this.currentValue;this.currentValue=a,b||this.container.trigger("change",{oldValue:c,newValue:a})}},g=function(a){var b=c("a",a);this.button.html("<span class='spritzer-wpm'>"+b.html()+'</span><span class="spritzer-caret"></span>'),c(d+" li",this.container).removeClass("selected"),a.addClass("selected")};return a.prototype.setValue=function(a,b){var d=c("li[data-value='"+a+"']",this.container);return 1==d.length&&(g.call(this,d),f.call(this,d.data("value"),b)),1==d.length},c(document).ready(function(){c(".spritzer-speed[data-role='select']").each(function(){var b=c(this);b.data("controller")instanceof a||new SPRITZ.component.BootstrapSelectController(b)})}),{BootstrapSelectController:a}}),SPRITZ.namespace("SPRITZ.model"),SPRITZ.model.TimedWord=function(a,b,c,d,e){var f=SPRITZ.model;f.TimedWord.FLAG_MASK=7,f.TimedWord.FLAG_SENTENCE_START=1,f.TimedWord.FLAG_BOLD=2,f.TimedWord.FLAG_PARAGRAPH_START=4,this.word=a,this.orp=b,this.multiplier=c,this.position=d,this.flags=e,this.isBold=function(){return 0!=(this.flags&f.TimedWord.FLAG_BOLD)},this.isSentenceStart=function(){return 0!=(this.flags&f.TimedWord.FLAG_SENTENCE_START)},this.isParagraphStart=function(){return 0!=(this.flags&f.TimedWord.FLAG_PARAGRAPH_START)},this.toString=function(){return'{"'+this.word+'", '+this.orp+", "+this.multiplier+", "+this.position+(this.isParagraphStart()?", paragraphStart":"")+(this.isSentenceStart()?", sentenceStart":"")+(this.isBold()?", bold":"")+"}"}},SPRITZ.model.TelemetryItem=function(a,b,c,d,e,f,g,h,i,j,k){this.id=a,this.time=g,this.user=b,this.userType=c,this.sessionId=d,this.category="ContentView",this.name=h,this.data={viewingSessionId:e,contentVersionId:f,"char":i,speed:j},"undefined"!=typeof k&&(this.data.interrupted=k)},SPRITZ.model.TelemetryBatch=function(a,b){this.clientOS=a,this.clientEvents=b},SPRITZ.model.IllegalArgumentException=function(a){this.name="IllegalArgumentException",this.message=a},SPRITZ.model.IllegalArgumentException.prototype=new Error,SPRITZ.model.IllegalArgumentException.prototype.constructor=SPRITZ.model.IllegalArgumentException,SPRITZ.model.ArrayIndexOutOfBoundsException=function(a){this.name="ArrayIndexOutOfBoundsException",this.message=a},SPRITZ.model.ArrayIndexOutOfBoundsException.prototype=new Error,SPRITZ.model.ArrayIndexOutOfBoundsException.prototype.constructor=SPRITZ.model.ArrayIndexOutOfBoundsException,SPRITZ.namespace("SPRITZ.model"),SPRITZ.model.SpritzText=function(a,b,c,d,e,f){var g=SPRITZ.model.SpritzText.SeekType,h=1.21,i=a,j=b,k=c,l=d,m=e,n=f,o=0,p=null;this.getContentVersionId=function(){return i},this.setContentVersionId=function(a){i=a},this.getDuration=function(){return k},this.getWords=function(){return j},this.getLocale=function(){return l},this.getVersion=function(){return m},this.getWord=function(a){return j[a]},this.getCurrentWord=function(){return j[o]},this.getNextWord=function(){return o<j.length?(this.setCurrentIndex(++o),j[o]):null},this.hasNextWord=function(){return o<j.length},this.getCurrentIndex=function(){return o},this.setCurrentIndex=function(a){var b;return a<=j.length?(o=a,null!=p&&p(o,j.length),b=!0):b=!1,b},this.size=function(){return j.length},this.getWordCount=function(){return n},this.isLoaded=function(){return j.length>0||j.length==n},this.reset=function(){this.setCurrentIndex(0)},this.getPreviousSentenceStart=function(a,b){var c=SPRITZ.model;if(0>a||a>=j.length)throw new c.ArrayIndexOutOfBoundsException(a);var d=a;if(b>0)for(;d>0&&b>0&&(!j[d].isSentenceStart()||0!=--b);d--);return d},this.getNextSentenceStart=function(a,b){var c=SPRITZ.model;if(0>a||a>=j.length)throw new c.ArrayIndexOutOfBoundsException(a);var d=a;if(b>0)for(;d<j.length&&(!j[d].isSentenceStart()||0!=--b);d++);return d},this.calculateTime=function(a,b){var c=0==j.length?n:j.length;return Math.round(6e4*k*(c-b)/(a*h*c))},this.getTotalTime=function(a){return this.calculateTime(a,0)},this.getRemainingTime=function(a){return this.calculateTime(a,o)},this.getProgressTracker=function(){return p},this.setProgressTracker=function(a){p=a},this.seek=function(a,b){var c;return a>=0&&a<=j.length?(c=!0,this.setCurrentIndex(b===g.ABSOLUTE?a:b===g.SENTENCE_START?this.getPreviousSentenceStart(a,1):a)):c=!1,c},this.clone=function(){var a=new SPRITZ.model.SpritzText(i,j,k,l,m,n);return a.contentId=this.contentId,a.setProgressTracker(p),a}},SPRITZ.model.SpritzText.SeekType=Object.freeze({ABSOLUTE:"absolute",SENTENCE_START:"sentenceStart"}),SPRITZ.model.SpritzText.create=function(a,b,c,d,e){var f=SPRITZ.model,g="V2",h="AAAC",i=goog.math.Long.fromInt(1073741823),j=goog.math.Long.fromInt(15),k=goog.math.Long.fromInt(16383),l=goog.math.Long.fromInt(7),m=1,n=2,o=4;if(b!==g)throw new Error("Unknown container format");if(!("object"==typeof c&&c instanceof Array&&"object"==typeof d&&d instanceof Array))throw new Error("Invalid data format: wrong types");if(0==d.length)throw new Error("Invalid data format: data2");var p=d[0];if("string"!=typeof p)throw new f.IllegalArgumentException("Invalid preamble");var q=p.split(",");if(q.length<4)throw new Error("Invalid preamble");if(q[0]!=h)throw new Error("Unrecognized encoding");var r=parseInt(q[1]),s=[];if(0==c.length){if(1!=d.length)throw new Error("Invalid data format: Wrong data length")}else if(c.length!=r||d.length-1!=r)throw new Error("Invalid data format: Wrong data length");for(var t=0;t<c.length;t++){var u=c[t],v=d[t+1],w=goog.math.Long.fromString(v,16),x=w.and(l).toInt(),y=0;0!=(x&m)&&(y|=f.TimedWord.FLAG_BOLD),0!=(x&n)&&(y|=f.TimedWord.FLAG_SENTENCE_START),0!=(x&o)&&(y|=f.TimedWord.FLAG_PARAGRAPH_START),w=w.shiftRight(3);var z=w.and(k).getLowBits();w=w.shiftRight(14);var A=w.and(j).getLowBits();w=w.shiftRight(4);var B=w.and(i).getLowBits();s.push(new f.TimedWord(u,A,z,B,y))}return new SPRITZ.model.SpritzText(a,s,e,q[2],q[3],r)},SPRITZ.namespace("SPRITZ.display"),SPRITZ.display.SpritzReadingPanel=function(a,b){var c=jQuery,d="SpritzReadingPanel: ";jsutil.debug(3,d+"Created "+d);var e=Object.freeze({ready:0,running:1,paused:2,completed:3}),f=null,g=SPRITZ.spritzinc.SpritzOptions,h=1.21,i=6e4,j="SpritzMedienMedium",k="arial",l=.4,m=.35,n=.1,o=.113,p=.03,q=0,r=0,s=0,t=0,u=null,v=g.defaultSpeed,w=null,x=null,y=0,z=!0,A=e.ready,B=g.redicle.textNormalPaintColor,C=g.redicle.countdownColor,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,Q=0,R=0,S=0,T=0,U=0;resizeable="undefined"==typeof b?!0:b;var V="",W="",X="",Y="",Z=function(){V=F+"px "+j,"undefined"!=typeof localStorage&&"ru"==localStorage.getItem("spritz.language")&&(V=F+"px "+k),W="bold "+V,X=V,Y=W},$=function(){D=a.width,E=a.height,F=Math.round(a.height*l);var b;-1==navigator.userAgent.toLowerCase().indexOf("firefox")?(T=1,U=3,b=-1):(T=2,U=2,b=1),U=U*a.height/60,G=Math.round(.56*F+.5),H=Math.round(.44*F+.5),I=G+H,J=Math.round(a.height*n),K=Math.round(q+(a.width-q-r)*m),L=Math.round(s+(a.height-s-t)/2),M=L-Math.round((G+H)/2)+b,N=0,O=a.width,P=Math.round(a.width*p),Q=Math.round(a.height*o),R=K-q,S=a.width-r-K,Z(),f=a.getContext("2d"),f.textBaseline="top",f.textAlign="left";var c=3;jsutil.debug(c,d+"dimensions: "+a.width+"x"+a.height),jsutil.debug(c,d+"fontSizeHeight: "+F),jsutil.debug(c,d+"ascent: "+G),jsutil.debug(c,d+"descent: "+H),jsutil.debug(c,d+"focus: "+K+","+L),jsutil.debug(c,d+"textY: "+M),jsutil.debug(c,d+"fontRealHeight: "+I),jsutil.debug(c,d+"textOverflow, top: "+T+", bottom: "+U),jsutil.debug(c,d+"textNormalPaint: "+V),jsutil.debug(c,d+"textNormalBoldPaint: "+W)},_=function(a,b,c,d,e,g){f.lineWidth=e,f.strokeStyle=g,f.beginPath(),f.moveTo(a,b),f.lineTo(c,d),f.stroke()},ab=function(){var b=q+P,c=a.width-r-P,d=s+Q,e=a.height-t-Q;_(b,d,c,d,g.redicle.redicleLineWidth,g.redicle.redicleLineColor),_(K,d,K,d+J,g.redicle.redicleLineWidth,g.redicle.redicleLineColor),_(b,e,c,e,g.redicle.redicleLineWidth,g.redicle.redicleLineColor),_(K,e-J,K,e,g.redicle.redicleLineWidth,g.redicle.redicleLineColor)},bb=function(a,b){f.font=b;var c=f.measureText(a);return c.width},cb=function(a,b,c,d,e){f.font=b,f.fillStyle=c,f.fillText(a,d,e)},db=function(a,b,c,d,e){f.fillStyle=e,f.fillRect(a,b,c,d)},eb=function(){db(q,s,a.width-r,a.height-t,g.redicle.backgroundColor)},fb=function(){B=z?g.redicle.textHighlightPaintColor:g.redicle.textNormalPaintColor},gb=function(){return u},hb=function(){if(A==e.running){pb();var a=gb().getNextWord();if(null==a){if(A=e.completed,rb(g.placeholderText.endText,g.placeholderText.endTextColor),null!=w){var b=w;delete w,b()}}else ob(a.word,a.orp,a.position,a.isBold()),x=setTimeout(function(){x=null,hb()},mb(a.multiplier))}else jsutil.debug(4,d+"displayNextWord interrupted on word # "+gb().getCurrentIndex()+" because of state: "+A)},ib=function(){y=(new Date).getTime(),jb(this)},jb=function(){var b=(new Date).getTime()-y,c=b/g.redicle.countdownTime,d=Math.max(R*c,0),e=Math.max(S*c,0),f=a.height-s-t,h=a.width-q-r;eb(),db(q+d,s,h-d-e,f,C),ab(),nb(),K>=d||e<=a.width-K?x=setTimeout(function(){x=null,jb()},g.redicle.countdownSlice):(eb(),ab(),nb(),hb(this))},kb=function(){return v},lb=function(a){return Math.floor(i/(a*h))},mb=function(a){return(1+a/100)*lb(kb())},nb=function(){var a=u.getCurrentWord();ob(a.word,a.orp,a.position,a.isBold())},ob=function(a,b,c,d){if(null!=a&&0!=a.length){var e,f,h=M;d?(e=W,f=Y):(e=V,f=X);var i,j,k,l,m,n,o=a.length;0==b?(i=null,l=0):(i=a.substring(0,b),l=Math.round(bb(i,e))),j=a.substring(b,b+1),m=Math.round(bb(j,f)),n=Math.round(m/2),k=b==o-1?null:a.substring(b+1),l>0&&cb(i,e,g.redicle.textNormalPaintColor,K-l-n,h),cb(j,f,B,K-n,h),null!=k&&cb(k,e,g.redicle.textNormalPaintColor,K+n,h)}},pb=function(){f.fillStyle=g.redicle.backgroundColor,f.fillRect(N,M-T,O-N,I+U+1)},qb=function(){var b=c(a),e=b.width(),f=b.height();e==D&&f==E?jsutil.debug(3,d+"dimensions unchanged: "+D+"x"+E):(jsutil.debug(3,d+"dimensions changed: "+D+"x"+E+" -> "+e+"x"+f),a.width=e,a.height=f,$())},rb=function(b,c){if(b){Z();var d=Math.round(a.width*p)+q,e=sb(b),f=e+"px "+j,h=Math.round((a.height-s-t)/2),i=h-e/2,k=c||g.redicle.textNormalPaintColor;cb(b,f,k,d,i)}},sb=function(b){var c=I,d=a.width-(q+r)-2*Math.round(a.width*p);if(f.measureText(b).width>d)do c--,f.font=c+"px "+j;while(f.measureText(b).width>d);return c},tb=function(a,b){for(var c=0,d=0,e=a.length;e>d;++d)!function(d){function e(){return f&&f.offsetWidth!=g&&(++c,f.parentNode.removeChild(f),f=null),c>=a.length&&(h&&clearInterval(h),c==a.length)?(b(),!0):void 0}var f=document.createElement("span");f.innerHTML="giItT1WQy@!-/#",f.style.position="absolute",f.style.left="-10000px",f.style.top="-10000px",f.style.fontSize="300px",f.style.fontFamily="sans-serif",f.style.fontVariant="normal",f.style.fontStyle="normal",f.style.fontWeight="normal",f.style.letterSpacing="0",document.body.appendChild(f);var g=f.offsetWidth;f.style.fontFamily=d;var h=0;e()||(h=setInterval(e,50))}(a[d])};!function(){tb(["SpritzMedienMedium","SpritzMedienBold"],function(){$(),f.fillStyle=g.redicle.backgroundColor,f.fillRect(0,0,a.width,a.height),ab(),rb(g.placeholderText.startText,g.placeholderText.startTextColor)})}(),this.getCurrentText=function(){return gb()},this.setCurrentText=function(a){this.pauseText(),u=a,pb()},this.getCurrentTextSpeed=function(){return kb()},this.setCurrentTextSpeed=function(a){v=a},this.getCurrentPosition=function(){return null!=u?u.getCurrentIndex():-1},this.setCurrentPosition=function(a){null!=u&&u.setCurrentIndex(a)},this.getHighlightBestLetter=function(){return z},this.setHighlightBestLetter=function(a){z=a,fb()},this.setOnCompleteCallback=function(a){w=a},this.isPaused=function(){return A==e.paused},this.isReady=function(){return A==e.ready},this.isRunning=function(){return A==e.running},this.isCompleted=function(){return A==e.completed},this.displayWord=function(a,b,c){ob(a,b,0,c)},this.eraseWord=function(){pb()},this.displayText=function(a,b){if(jsutil.debug(4,d+"Displaying text with "+a.size()+" words in "+v+" words/min"),u=a,w=b,u.hasNextWord())A=e.running,resizeable&&qb(),fb(),ib();else if(null!=w){var b=w;delete w,b()}},this.displayPlaceholderText=function(a,b){eb.call(this),ab.call(this),rb(a,b)},this.pauseText=function(){A==e.running&&(null!=x&&(clearTimeout(x),x=null),u.getCurrentIndex()>0&&u.setCurrentIndex(u.getCurrentIndex()),A=e.paused),A=e.paused},this.resumeText=function(a){u?u.hasNextWord()?(jsutil.debug(4,d+"Resuming text with "+u.size()+" words at word # "+(u.getCurrentIndex()+1)),A=e.running,resizeable&&qb(),fb(),"undefined"==typeof a||a?ib():hb(this)):jsutil.debug(4,d+"Cannot resume Text because there are no more words"):jsutil.debug(2,d+"Cannot resume Text because it is null")},this.resetText=function(){this.pauseText(),u=null,eb.call(this),ab.call(this)},this.reset=function(){eb.call(this),ab.call(this),u&&u.hasNextWord()&&nb()}},SPRITZ.namespace("SPRITZ.client"),SPRITZ.addToNamespace(SPRITZ.client,function(){var a={name:"Spritz_JSSDK",version:"1.2.0",buildDate:"Mon Jun 16 2014 13:57:41 GMT-0600 (MDT)"};return{VersionInfo:a}}),SPRITZ.addToNamespace(SPRITZ.namespace("SPRITZ.client"),function(){function a(){return"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)}function b(a,b){this.code=a,this.message=b}function c(a,b,c){this.url=b+"/oauth/authorize?c="+encodeURIComponent(SPRITZ.client.VersionInfo.name+"_"+SPRITZ.client.VersionInfo.version)+"&response_type=token&client_id="+a+"&redirect_uri="+encodeURIComponent(c),this.onSuccess=null,this.onError=null}var d=function(a){"function"==typeof window.removeEventListener?(window.removeEventListener("message",this.onMessageHandler,!1),"object"==typeof console&&console.log("Registered listener via addEventListener")):window.detachEvent("onmessage",this.onMessageHandler),localStorage.removeItem("spritz.authResponse"),this.onSuccess&&this.onSuccess(a.data),this.showing=!1,a.source.close()};return c.prototype.show=function(b,c){this.onSuccess=b,this.onError=c,"object"==typeof console&&console.log("opening auth popup with URL: ",this.url),"undefined"==typeof localStorage&&localStorage.removeItem("spritz.authResponse");var e=window.open(this.url,"SpritzLogin","width=400,height=400,location=0,menubar=0,toolbar=0");if(e){e.focus(),this.showing=!0,this.onMessageHandler=jsutil.createDelegate(this,d),"function"==typeof window.addEventListener?(window.addEventListener("message",this.onMessageHandler,!1),"object"==typeof console&&console.log("Registered listener via addEventListener")):window.attachEvent("onmessage",this.onMessageHandler);var f=a(),g=this,h=null;h=setInterval(function(){if("undefined"!=typeof localStorage){var a=localStorage.getItem("spritz.authResponse");null!==a&&g.onMessageHandler({data:a,source:e})}if(f)try{e.name&&-1!==e.name.indexOf("#access_token")&&g.onMessageHandler({data:e.name,source:e})}catch(b){console.error(b)}g.showing&&e?e.closed&&(clearInterval(h),g.showing=!1,g.onError&&g.onError(new Error("Login aborted"))):clearInterval(h)},250)}else alert("Please enable popups to use Spritz."),console&&console.log("Unable to open popup."),this.onError&&this.onError(new Error("Popup unable to open."))},{APIError:b,AuthPopup:c}}),SPRITZ.addToNamespace(SPRITZ.namespace("SPRITZ.client"),function(){var a=Object.freeze({USER_ID:"userId",USER_NAME:"userName",GUEST_ID:"guestId"}),b=jQuery,c=function(a){var b={};if(null===a||0===a.length)return b;var c=a.indexOf("#");c>=0&&(a=a.substring(c+1));for(var d=a.split("&"),e=0;e<d.length;e++){var f,g,h=d[e],i=h.indexOf("=");-1===i?(f=decodeURIComponent(h),g=!0):(f=decodeURIComponent(h.substring(0,i)),g=decodeURIComponent(h.substring(i+1))),b[f]=g}return b},d=function(a,b){return"spritz."+b+"Token."+a},e=function(){var a=this.apiRoot.indexOf("//");if(-1===a)this.apiHost="api.spritzinc.com";else{var b=this.apiRoot.indexOf("/",a+2);this.apiHost=-1===b?this.apiRoot.substring(a+2):this.apiRoot.substring(a+2,b)}},f=function(){"/"===this.apiRoot.substring(this.apiRoot.length-1)&&(this.apiRoot=this.apiRoot.substring(0,this.apiRoot.length-1))},g=function(a){var b=null;return 500===a.status||403===a.status,null===b&&(b=new SPRITZ.client.APIError(a.status,"HTTP call failed, status: "+a.status+", message: "+a.statusText)),b},h=function(a,c,d,e){var f,h,k=null,l=1,n=this;if(f=function(){console&&console.log("Invoking "+a.type+" "+a.url);var c=function(a){if(401===a.status&&1===l)l++,"user"===k?u.call(n,null):"guest"===k?v.call(n,null):"client"===k&&t.call(n,null),h();else{var b=g(a);e?e(b):console&&console.log(b.code+": "+b.message)}};"user"===k?a.headers={Authorization:"Bearer "+n.userAccessToken}:"guest"===k?a.headers={Authorization:"Bearer "+n.guestAccessToken}:"client"===k&&(a.headers={Authorization:"Bearer "+n.clientAccessToken}),a.success=d,a.error=c,b.ajax(a)},h=function(){if(c||null!==n.userAccessToken||null!==n.guestAccessToken)if(c)if(null!==n.userAccessToken)k="user",f();else if(k="guest",null===n.guestAccessToken){var a=function(a){e&&e(new Error("API call failed, guest login failed: "+a.message))};j.call(n,f,a)}else f();else f();else if(k="client",null===n.clientAccessToken){var b=function(a){"cause"in a&&a.cause instanceof SPRITZ.client.APIError&&403===a.cause.code?("object"==typeof console&&console.log("Client login failed with status 403, retrying API call with userRequired"),c=!0,h()):e&&e(new Error("API call failed, client login failed: "+a.message))};i.call(n,f,b)}else f()},n.initialized)h();else{var o=function(a){e&&e(new Error("Execution failed, unable to get accessToken: "+a.message))};m.call(n,h,o)}},i=function(a,c){var d=this,e=function(b){"access_token"in b&&"token_type"in b&&"bearer"===b.token_type?"function"==typeof a&&n.call(d,b.access_token,a,c):"function"==typeof c&&c(new Error("Client login failed, invalid response"))},f=function(a){var b=g.call(d,a);if(403===b.code&&("object"==typeof console&&console.log("Client ID "+d.clientId+" is not authorized to use anonymous mode"),d.anonymousEnabled=!1),"function"==typeof c){var e=new Error("Unable to perform client login: "+b.message);e.cause=b,c(e)}};b.ajax({type:"GET",url:this.apiRoot+"/oauth/clientToken?clientId="+encodeURIComponent(this.clientId),dataType:"json",async:!0,success:e,error:f})},j=function(c,d){var e=this,f=function(b){"userid"in b&&"token"in b?b.audience===e.clientId?(e.storageHandler.put(a.GUEST_ID,b.userid),v.call(e,b.token),c()):"function"==typeof d&&d(new Error("clientId mismatch")):"function"==typeof d&&d(new Error("Guest login failed, invalid response"))},h=function(a){var b=g.call(e,a);if(403===b.code&&("object"==typeof console&&console.log("Client ID "+e.clientId+" is not authorized to use guest mode"),e.anonymousEnabled=!1),"function"==typeof d){var c=new Error("Unable to perform guest login: "+b.message);c.cause=b,d(c)}};b.ajax({type:"GET",url:this.apiRoot+"/oauth/guestToken?clientId="+encodeURIComponent(this.clientId),xhrFields:{withCredentials:!0},dataType:"json",async:!0,success:f,error:h})},k=function(a,b,c,d,e){var f=this,g=1,i=!f.anonymousEnabled,j={url:a};"undefined"!=typeof b&&(j.selector=b,j.selectorType="undefined"==typeof c?"CSS":c);var k=function(){h.call(f,{type:"POST",contentType:"application/json",url:f.apiRoot+"/content",dataType:"json",async:!0,data:JSON.stringify(j)},i,function(a){d&&d(a)},function(a){!i&&"code"in a&&403===a.code&&1===g?("object"==typeof console&&console.log("Content retrieval in anonymous failed with 403, retrying with userRequired=true"),g++,i=!0,k()):"function"==typeof e&&e(new Error("Content retrieval failed: "+a.message))})};k()},l=function(a,b,c,d,e){h.call(this,{type:"GET",url:this.apiRoot+"/contentVersion?includeSpritzableText="+b+"&includePlainText="+c+"&sortColumn=createdDate&sortDirection=DESC&pageSize=1&contentId="+encodeURIComponent(a),dataType:"json",async:!0},!this.anonymousEnabled,function(f){if(0===f.content.length)e&&e(new Error("No contentVersion returned"));else{var g=f.content[0];if(d){var h=SPRITZ.model.SpritzText.create(g.id,g.sd0,g.sd1,g.sd2,g.duration);c&&(h.plainText=g.plainText),b||(h.contentId=a),d(h)}}},function(b){e&&e(new Error("Unable to retrieve contentVersion, contentId="+a+": "+b.message))})},m=function(a,b){var c=null;try{this.initialized=!0}catch(d){c=d}null===c?a&&a():"function"==typeof b&&b(new Error("Initialization failed: "+c.message))},n=function(a,b){t.call(this,a),"function"==typeof b&&b(a)},o=function(a,b,d){var e=c(a);e.access_token&&e.token_type?"bearer"===e.token_type?w.call(this,e.access_token,b,d):this.onError&&this.onError(new Error("Unexpected token type: "+e.token_type)):this.onError&&this.onError(new Error("No token data in response"))},p=function(a,b){u.call(this,a),b&&(b(a),this.loginCallback&&this.loginCallback())},q=function(a){"undefined"!=typeof localStorage&&localStorage.removeItem(d(this.apiHost,a))},r=function(a,b){"undefined"!=typeof localStorage&&localStorage.setItem(d(this.apiHost,a),b)},s=function(a){var b;return b="undefined"==typeof localStorage?null:localStorage.getItem(d(this.apiHost,a))},t=function(a){if(this.clientAccessToken=a,null===a)q.call(this,"client");else try{r.call(this,"client",a)}catch(b){console&&console.log("Error with localStorage: ",b)}},u=function(a){if(this.userAccessToken=a,null===a)q.call(this,"user");else try{r.call(this,"user",a)}catch(b){console&&console.log("Error with localStorage: ",b)}},v=function(a){if(this.guestAccessToken=a,null===a)q.call(this,"guest");else try{r.call(this,"guest",a)}catch(b){console&&console.log("Error with localStorage: ",b)}},w=function(c,d,e){var f=function(a){e&&e(new Error("Token validation failed: "+a.message+" Please make sure you are not using Internet Explorer 9 or less, as Spritz is unsupported in those browsers."))},g=this;b.ajax({type:"GET",url:this.apiRoot+"/oauth/tokeninfo?access_token="+encodeURIComponent(c),dataType:"json",async:!0,success:function(b){b.audience===g.clientId?(g.storageHandler.put(a.USER_ID,b.userid),g.storageHandler.put(a.USER_NAME,b.username),p.call(g,c,d,e)):f(new Error("clientId mismatch"))},error:f})},x=function(a,b,c){this.clientId=a,this.apiRoot=b,this.redirectUri=c,this.initialized=!1,this.clientAccessToken=null,this.guestAccessToken=null,this.userAccessToken=null,this.apiHost=null,this.anonymousEnabled=!1,this.loginCallback=null,this.logoutCallback=null,f.call(this),e.call(this),this.clientAccessToken=s.call(this,"client"),this.guestAccessToken=s.call(this,"guest"),this.userAccessToken=s.call(this,"user"),this.storageHandler=new SPRITZ.datastore.StorageHandler};return x.prototype.userLogin=function(a,b){var c=new SPRITZ.client.AuthPopup(this.clientId,this.apiRoot,this.redirectUri),d=this,e=function(c){o.call(d,c,a,b)},f=function(a){"function"==typeof b&&b(new Error("Login Failed: "+a.message))};c.show(e,f)},x.prototype.fetchContents=function(a,b,c,d,e){var f=this,g=function(a){l.call(f,a.id,!0,!1,b,c)};k.call(this,a,d,e,g,c)},x.prototype.fetchContents2=function(a,b,c,d){var e,f,g,h,i=this;"undefined"==typeof d?(e=null,f=null,g=!1,h=!0):(e="undefined"==typeof d.selector?null:d.selector,f="undefined"==typeof d.selectorType?null:d.selectorType,g="undefined"==typeof d.includePlainText?!1:d.includePlainText,h="undefined"==typeof d.includeSpritzableText?!0:d.includeSpritzableText);var j=function(a){l.call(i,a.id,h,g,b,c)};k.call(this,a,e,f,j,c)},x.prototype.fetchContentsByContentId=function(a,b,c,d){var e,f;"undefined"==typeof d?(e=!1,f=!0):(e="undefined"==typeof d.includePlainText?!1:d.includePlainText,f="undefined"==typeof d.includeSpritzableText?!0:d.includeSpritzableText),l.call(this,a,f,e,b,c)},x.prototype.userLogout=function(){this.storageHandler.remove(a.USER_ID),this.storageHandler.remove(a.USER_NAME),u.call(this,null),this.logoutCallback&&this.logoutCallback()},x.prototype.isUserLoggedIn=function(){return"string"==typeof this.userAccessToken&&this.userAccessToken.length>0},x.prototype.setAuthResponse=function(a,b,c){o.call(this,a,b,c)},x.prototype.spritzify=function(a,b,c,d){h.call(this,{type:"POST",url:this.apiRoot+"/misc/spritzify",dataType:"json",async:!0,data:{plainText:a,locale:b}},!0,function(a){try{var b=SPRITZ.model.SpritzText.create(a.plainTextHash,a.sd0,a.sd1,a.sd2,a.duration);"function"==typeof c&&c(b)}catch(e){"function"==typeof d&&d(new Error("Invalid data received: "+e.message))}},function(a){if("function"==typeof d){var b;b="undefined"!=typeof a.message?a.message:a.status+" ["+a.statusText+"]",d(new Error("Unable to retrive spritzableText: "+b))}})},x.prototype.sendTelemetry=function(a,b,c){var d=a.clientEvents[0].user,e="g"===a.clientEvents[0].userType?"guest":"user";h.call(this,{type:"POST",contentType:"application/json",url:this.apiRoot+"/"+e+"/"+d+"/event",dataType:"json",async:!0,data:JSON.stringify(a)},!0,function(c){"function"==typeof b&&b(a,c)},function(b){if("function"==typeof c){var d;d="undefined"!=typeof b.message?b.message:b.status+" ["+b.statusText+"]",c(a,new Error("Unable to send Telemetry: "+d))}})},x.prototype.setAnonymousEnabled=function(a){this.anonymousEnabled=a===!0},x.prototype.getGuestId=function(){return this.storageHandler.get(a.GUEST_ID)
},x.prototype.setGuestId=function(b){this.storageHandler.put(a.GUEST_ID,b)},x.prototype.getUserId=function(){return this.storageHandler.get(a.USER_ID)},x.prototype.setUserId=function(b){this.storageHandler.put(a.USER_ID,b)},x.prototype.getUserName=function(){return this.storageHandler.get(a.USER_NAME)},x.prototype.setUserName=function(b){this.storageHandler.put(a.USER_NAME,b)},x.prototype.registerLoginCallback=function(a){"function"==typeof a&&(this.loginCallback=a)},x.prototype.registerLogoutCallback=function(a){"function"==typeof a&&(this.logoutCallback=a)},{SpritzClient:x}}),SPRITZ.namespace("SPRITZ.datastore"),SPRITZ.addToNamespace(SPRITZ.datastore,function(){function a(){}a.prototype.get=function(a){var c=localStorage.getItem(b(a));return null==c?(jsutil.debug(4,"Item ["+a+"] does not exist"),null):d(c)},a.prototype.select=function(a){for(var c=[],e=b(a),f=0,g=localStorage.length;g>f;f+=1){var h=localStorage.key(f);0==h.indexOf(e)&&c.push(d(localStorage.getItem(h)))}return jsutil.debug(5,"Select returning "+c.length+" items"),c},a.prototype.put=function(a,d){localStorage.setItem(b(a),c(d))},a.prototype.remove=function(a){for(var c=0,d=b(a),e=0,f=localStorage.length;f>e;e+=1){var g=localStorage.key(e);null!=g&&0==g.indexOf(d)&&(localStorage.removeItem(g),c+=1)}return c};var b=function(a){return"spritz."+a},c=function(a){return JSON.stringify(a)},d=function(a){try{return JSON.parse(a)}catch(b){return jsutil.debug(5,"Failed to parse item, exception ["+b.name+"] msg["+b.message+"]"),jsutil.debug(1,"Item is not JSON - returning the raw value: ["+a+"]"),a}};return{StorageHandler:a,composeKey:b}}),SPRITZ.namespace("SPRITZ.display"),SPRITZ.addToNamespace(SPRITZ.display,function(){function a(a,b){this.redicle=new SPRITZ.display.SpritzReadingPanel(a,b),this.telemetryHandler=new SPRITZ.spritzinc.TelemetryHandler}function b(a){this.telemetryHandler.stop(this.redicle.getCurrentText(),this.redicle.getCurrentTextSpeed()),a()}function c(a){var b=a.getCurrentIndex();if(b>=0){var c;a.hasNextWord()?c=2:(b--,c=1),b=a.getPreviousSentenceStart(b,c),""==a.getWord(b).word&&b<a.size()-1&&(b+=1)}return b}function d(a){var b=a.getCurrentIndex();return b<a.size()-1&&(b=a.getNextSentenceStart(b+1,1)),b}return a.prototype.getCurrentText=function(){return this.redicle.getCurrentText()},a.prototype.setCurrentText=function(a){null!=this.redicle.getCurrentText()&&this.telemetryHandler.stop(this.redicle.getCurrentText(),this.redicle.getCurrentTextSpeed()),this.redicle.setCurrentText(a)},a.prototype.getCurrentTextSpeed=function(){return this.redicle.getCurrentTextSpeed()},a.prototype.setCurrentTextSpeed=function(a){null!=this.redicle.getCurrentText()&&this.telemetryHandler.changeSpeed(this.redicle.getCurrentText(),a),this.redicle.setCurrentTextSpeed(a)},a.prototype.getCurrentPosition=function(){return null!=this.getCurrentText()?this.getCurrentText().getCurrentIndex():-1},a.prototype.setCurrentPosition=function(a){null!=this.getCurrentText()&&(this.redicle.isRunning()&&this.telemetryHandler.pause(this.redicle.getCurrentText(),this.redicle.getCurrentTextSpeed()),this.redicle.setCurrentPosition(a))},a.prototype.getHighlightBestLetter=function(){return this.redicle.getHighlightBestLetter()},a.prototype.setHighlightBestLetter=function(a){this.redicle.setHighlightBestLetter(a)},a.prototype.setOnCompleteCallback=function(a){jsutil.createDelegate(this,function(){b(a)})},a.prototype.isPaused=function(){return this.redicle.isPaused()},a.prototype.isReady=function(){return this.redicle.isReady()},a.prototype.isRunning=function(){return this.redicle.isRunning()},a.prototype.isCompleted=function(){return this.redicle.isCompleted()},a.prototype.displayText=function(a,c){this.redicle.getCurrentText()&&this.telemetryHandler.stop(this.redicle.getCurrentText(),this.redicle.getCurrentTextSpeed()),this.redicle.displayText(a,jsutil.createDelegate(this,function(){b.call(this,c)})),this.telemetryHandler.viewStart(this.redicle.getCurrentText(),this.redicle.getCurrentTextSpeed())},a.prototype.pauseText=function(){this.redicle.isRunning()&&this.telemetryHandler.pause(this.redicle.getCurrentText(),this.redicle.getCurrentTextSpeed()),this.redicle.pauseText()},a.prototype.resumeText=function(a){(this.redicle.isReady()||this.redicle.isPaused())&&this.telemetryHandler.start(this.redicle.getCurrentText(),this.redicle.getCurrentTextSpeed()),this.redicle.resumeText(a)},a.prototype.resetUser=function(){this.pauseText(),this.telemetryHandler.resetUser()},a.prototype.resetText=function(){null!=this.redicle.getCurrentText()&&(this.redicle.pauseText(),this.telemetryHandler.stop(this.redicle.getCurrentText(),this.redicle.getCurrentTextSpeed()),this.redicle.resetText())},a.prototype.goToFirstWord=function(){this.getCurrentText()&&(this.redicle.pauseText(),this.telemetryHandler.rewind(this.getCurrentText(),this.redicle.getCurrentTextSpeed()),this.getCurrentText().reset(),this.redicle.reset())},a.prototype.goToPreviousSentence=function(){this.getCurrentText()&&(this.redicle.pauseText(),this.telemetryHandler.backup(this.getCurrentText(),this.redicle.getCurrentTextSpeed()),this.getCurrentText().setCurrentIndex(c(this.getCurrentText())),this.redicle.reset())},a.prototype.goToNextSentence=function(){this.getCurrentText()&&(this.redicle.pauseText(),this.telemetryHandler.forward(this.getCurrentText(),this.redicle.getCurrentTextSpeed()),this.getCurrentText().setCurrentIndex(d(this.getCurrentText())),this.redicle.reset())},a.prototype.seek=function(a,b){var c;return this.getCurrentText()?this.getCurrentText().seek(a,b)?(this.redicle.pauseText(),this.telemetryHandler.seek(this.getCurrentText(),this.redicle.getCurrentTextSpeed()),this.redicle.reset(),c=!0):(jsutil.debug(4,name+"SpritzText.seek() failed"),c=!1):(jsutil.debug(4,name+"Cannot seek because text is null"),c=!1),c},{SpritzDisplayProxy:a}}),SPRITZ.namespace("SPRITZ.spritzinc"),SPRITZ.addToNamespace(SPRITZ.spritzinc,function(){function a(){this.userAgent=navigator.userAgent,this.sessionId=m(),this.viewingSessionId=m(),this.contentVersionId=null,this.items=[],this.eventId=0,this.storageHandler=new SPRITZ.datastore.StorageHandler,this.startTime=(new Date).getTime(),this.updateTime=this.startTime,this.inactivityTimeout=null,this.userId=null,this.userType=null,this.started=!1,b.call(this),n.call(this,this.startTime)}function b(){this.userType=null,this.userId=SpritzClient.getUserId(),null!==this.userId?this.userType="u":(this.userId=SpritzClient.getGuestId(),null!==this.userId&&(this.userType="g"))}function c(){this.inactivityTimeout=setTimeout(jsutil.createDelegate(this,e),q.BATCH_TIMEOUT)}function d(){null!=this.inactivityTimeout&&(clearTimeout(this.inactivityTimeout),this.inactivityTimeout=null)}function e(){jsutil.debug(3,"Processing inactivity timeout with ["+this.items.length+"] item(s)"),this.items.length>0&&f.call(this)}function f(){d.call(this),g.call(this,this.items),this.items=[],this.startTime=(new Date).getTime()}function g(a){var b=new SPRITZ.model.TelemetryBatch(this.userAgent,a);SpritzClient.sendTelemetry(b,jsutil.createDelegate(this,h),jsutil.createDelegate(this,i))}function h(a,b){var c=a.clientEvents[0].sessionId,d=a.clientEvents[0].data.contentVersionId;b.length<a.clientEvents.length&&jsutil.debug(3,"Failed to process ["+(a.clientEvents.length-b.length)+"] item(s)");for(var e=0,f=b.length;f>e;e+=1)0==this.storageHandler.remove(j(c,d,b[e]))&&jsutil.debug(3,"Failed to remove item ["+b[e]+"]")}function i(a,b){jsutil.debug(3,"Failed to send batch ["+b.message+"]");for(var c=0,d=a.clientEvents.length;d>c;c+=1){var e=a.clientEvents[c];l(new Date(e.time).getTime())>q.HOLDING_PERIOD&&0==this.storageHandler.remove(j(e.sessionId,e.data.contentVersionId,e.data.id))&&jsutil.debug(3,"Failed to remove item ["+ids[c]+"]")}}function j(a,b,c){return q.TELEMETRY_KEY+"."+a+"."+b+"."+c}function k(a){return"undefined"==typeof a?new Date:a}function l(a){return(new Date).getTime()-a}function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}function n(a){for(var b=[],c="",d="",e="",f=this.storageHandler.select(q.TELEMETRY_KEY).sort(o),h=f.length-1;h>=0;h--){var i=f[h],j="Date"==typeof i.time?i.time:new Date(i.time);j.getTime()>=a&&f.splice(h,1)}for(var h=0,k=f.length;k>h;h+=1){var i=f[h];(i.user!=c||i.sessionId!=d||i.data.contentVersionId!=e)&&(b.length>0&&(g.call(this,b),b=[]),c=i.user,d=i.sessionId,e=i.data.contentVersionId),b.push(i)}b.length>0&&g.call(this,b)}function o(a,b){var c;return c=a.user>b.user?1:a.user<b.user?-1:a.sessionId>b.sessionId?1:a.sessionId<b.sessionId?-1:a.data.contentVersionId>b.data.contentVersionId?1:a.data.contentVersionId<b.data.contentVersionId?-1:a.id>b.id?1:a.id<b.id?-1:a.time>b.time?1:a.time<b.time?-1:0}var p=Object.freeze({VIEW_START:"SpritzViewStart",START:"SpritzStart",STOP:"SpritzStop",PAUSE:"SpritzPause",BACKUP:"SpritzBackup",FORWARD:"SpritzForward",REWIND:"SpritzRewind",SEEK:"SpritzSeek",SPEED:"SpritzSpeed"}),q=Object.freeze({ANONYMOUS:"anonymous",TELEMETRY_KEY:"telemetry",BATCH_SIZE:50,BATCH_TIMEOUT:6e4,HOLDING_PERIOD:6048e5});return a.prototype.resetUser=function(){this.items.length>0&&f.call(this),this.userId=null,this.userType=null},a.prototype.viewStart=function(a,b){this.checkPreviousContent(a),this.contentVersionId=a.getContentVersionId(),this.items=[];var c=new Date;this.startTime=c.getTime(),this.storeEvent(p.VIEW_START,a,b,c),this.started=!0},a.prototype.start=function(a,b){this.checkPreviousContent(a),this.storeEvent(p.START,a,b),this.started=!0},a.prototype.stop=function(a,b){this.started&&(this.storeEvent(p.STOP,a,b,void 0,a.hasNextWord()),this.started=!1),this.items.length>0&&f.call(this)},a.prototype.pause=function(a,b){this.checkPreviousContent(a),this.storeEvent(p.PAUSE,a,b),this.started=!0},a.prototype.backup=function(a,b){this.checkPreviousContent(a),this.storeEvent(p.BACKUP,a,b),this.started=!0},a.prototype.forward=function(a,b){this.checkPreviousContent(a),this.storeEvent(p.FORWARD,a,b),this.started=!0},a.prototype.rewind=function(a,b){this.checkPreviousContent(a),this.storeEvent(p.REWIND,a,b),this.started=!0},a.prototype.seek=function(a,b){this.checkPreviousContent(a),this.storeEvent(p.SEEK,a,b),this.started=!0},a.prototype.changeSpeed=function(a,b){this.checkPreviousContent(a),this.storeEvent(p.SPEED,a,b),this.started=!0},a.prototype.checkPreviousContent=function(a){this.items.length>0&&(null!=this.contentVersionId&&this.contentVersionId!=a.getContentVersionId()||l(this.startTime)>=q.BATCH_TIMEOUT)&&f.call(this)},a.prototype.storeEvent=function(a,b,e,g,h){if(null!==this.getUserId()){d.call(this),this.eventId++;var i=b.hasNextWord()?b.getCurrentWord().position:-1,l=j(this.sessionId,this.contentVersionId,this.eventId),m=new SPRITZ.model.TelemetryItem(this.eventId,this.getUserId(),this.userType,this.sessionId,this.viewingSessionId,this.contentVersionId,k(g),a,i,e,h);jsutil.debug(3,"Added item: "+JSON.stringify(m)),this.storageHandler.put(l,m),this.items.push(m),this.updateTime=(new Date).getTime(),this.items.length>=q.BATCH_SIZE&&f.call(this),c.call(this)}},a.prototype.getUserId=function(){return null==this.userId&&b.call(this),this.userId},{TelemetryHandler:a,batchTimeout:q.BATCH_TIMEOUT,batchSize:q.BATCH_SIZE,holdingPeriod:q.HOLDING_PERIOD,EventTypeEnum:p,submitPendingItems:n,sendBatchSuccess:h,sendBatchFailure:i}}),SPRITZ.namespace("SPRITZ.spritzinc"),SPRITZ.addToNamespace(SPRITZ.spritzinc,function(){function a(a){this.spritzClient=null,this.loading=!1,this.container=null,this.parentContainer=null,this.spritzPanel=null,this.pausePlayBtn=null,this.rewindBtn=null,this.backBtn=null,this.forwardBtn=null,this.pauseTitle=null,this.playTitle=null,this.speedDropdownController=null,this.progressReporter=null,this.seekPosition=null,this.seekMode=null,this.playOnFetchSuccess=!1,this.maxUnregisteredSpeed=U,this.minUnregisteredSpeed=V,b.call(this,a)}function b(a){var b=this,c=SPRITZ.spritzinc.SpritzOptions=y(a);this.container=I(D(c));var d=I("."+T,this.container);this.spritzPanel=new SPRITZ.display.SpritzDisplayProxy(d[0]),this.pausePlayBtn=I("."+M,this.container),this.rewindBtn=I("."+N,this.container),this.backBtn=I("."+O,this.container),this.forwardBtn=I("."+P,this.container),c.header.close&&(this.closeBtn=I("."+R,this.container),c.header.closeHandler&&(c.header.closeHandler=jsutil.createDelegate(this,c.header.closeHandler)),this.closeBtn.on("click",c.header.closeHandler||this.hideSpritzer.bind(b)));for(var l={pauseplay:e,rewind:f,back:g,forward:h,redicle:i,complete:j,speedchange:k},m=c.controlButtons,n=0,o=m.length;o>n;n+=1)I("."+J+m[n],this.container).on("click",jsutil.createDelegate(this,l[m[n]]));if(d.on("click",jsutil.createDelegate(this,i)),c.speedItems.length>0){var p=I(".spritzer-speed",this.container);this.speedDropdownController=new SPRITZ.component.BootstrapSelectController(p),p.on("change",jsutil.createDelegate(this,k))}var q=x.call(this)||c.defaultSpeed;this.spritzPanel.setCurrentTextSpeed(q),this.progressReporter=jsutil.createDelegate(this,H),u.call(this),v.call(this,!0),this.pauseTitle=c.controlTitles.pause,this.playTitle=c.controlTitles.play,I(".spritzer-login-btn",this.container).on("click",jsutil.createDelegate(this,z)),I(".spritzer-logout-btn",this.container).on("click",jsutil.createDelegate(this,A)),B.call(this,SpritzClient.isUserLoggedIn())}function c(a){I("#spritzer-loading").hide(),this.loading=!1,this.pausePlayBtn.removeClass(Q),null!==this.seekPosition&&a.seek(this.seekPosition,this.seekMode),this.playOnFetchSuccess?(this.startSpritzing(a),u.call(this,!0),v.call(this,!1)):this.setSpritzText(a),this.playOnFetchSuccess=!1}function d(a){I("#spritzer-loading").hide(),this.loading=!1,this.pausePlayBtn.removeClass(Q),this.playOnFetchSuccess=!1,"object"==typeof console&&console.log("Unable to spritz: "+a.message)}function e(){null==this.spritzPanel.getCurrentText()?this.loadText(!0):w(this.pausePlayBtn)&&(this.spritzPanel.isPaused()||this.spritzPanel.isReady()?(this.resumeSpritzing(),u.call(this,!0),m.call(this,this.playTitle)):(this.spritzPanel.pauseText(),u.call(this),v.call(this,!0),m.call(this,this.pauseTitle)))}function f(){if(w(this.rewindBtn)){var a=this.spritzPanel.getCurrentPosition();this.spritzPanel.goToFirstWord(),u.call(this),v.call(this,!0),n.call(this,a)}}function g(){if(w(this.backBtn)){var a=this.spritzPanel.getCurrentPosition();this.spritzPanel.goToPreviousSentence(),u.call(this),v.call(this,!0),o.call(this,a)}}function h(){if(w(this.forwardBtn)){var a=this.spritzPanel.getCurrentPosition();this.spritzPanel.goToNextSentence(),u.call(this),v.call(this,!0),p.call(this,a)}}function i(){null==this.spritzPanel.getCurrentText()?this.loadText(!0):w(this.pausePlayBtn)&&this.spritzPanel.getCurrentText().hasNextWord()?this.spritzPanel.isPaused()||this.spritzPanel.isReady()?(this.resumeSpritzing(),u.call(this,!0),q.call(this,this.playTitle)):(this.spritzPanel.pauseText(),u.call(this),v.call(this,!0),q.call(this,this.pauseTitle)):(this.spritzPanel.goToFirstWord(),this.resumeSpritzing(),u.call(this,!0),q.call(this,this.playTitle))}function j(){u.call(this),v.call(this,!0),r.call(this)}function k(a,b){if(a.preventDefault(),b&&"object"==typeof b)var c=b.newValue;if(c){var d=parseInt(c,10);this.spritzPanel.setCurrentTextSpeed(d),s.call(this)}}function l(a,b){var c=[];c.push(this.spritzPanel.getCurrentPosition()),"undefined"!=typeof b&&c.push(b),null!==this.parentContainer&&this.parentContainer.trigger("onSpritz"+a,c)}function m(a){l.call(this,a)}function n(a){l.call(this,"Rewind",a)}function o(a){l.call(this,"Back",a)}function p(a){l.call(this,"Forward",a)}function q(a){l.call(this,a)}function r(){null!==this.parentContainer&&this.parentContainer.trigger("onSpritzComplete")}function s(){null!==this.parentContainer&&this.parentContainer.trigger("onSpritzSpeedChange",[this.spritzPanel.getCurrentTextSpeed()])}function t(a){null!==this.parentContainer&&this.parentContainer.trigger("onProgressChange",[a])}function u(a){null==this.spritzPanel.getCurrentText()||0==this.spritzPanel.getCurrentText().getWords().length?(this.pausePlayBtn.addClass(Q),this.rewindBtn.addClass(Q),this.backBtn.addClass(Q),this.forwardBtn.addClass(Q)):a||this.spritzPanel.getCurrentPosition()>0&&this.spritzPanel.getCurrentText().hasNextWord()?(this.pausePlayBtn.removeClass(Q),this.rewindBtn.removeClass(Q),this.backBtn.removeClass(Q),this.forwardBtn.removeClass(Q)):0==this.spritzPanel.getCurrentPosition()?(this.pausePlayBtn.removeClass(Q),this.rewindBtn.addClass(Q),this.backBtn.addClass(Q),this.forwardBtn.removeClass(Q)):this.spritzPanel.getCurrentText().hasNextWord()||(this.pausePlayBtn.addClass(Q),this.rewindBtn.removeClass(Q),this.backBtn.removeClass(Q),this.forwardBtn.addClass(Q))}function v(a){a?(this.pausePlayBtn.removeClass(L),this.pausePlayBtn.addClass(K),this.pausePlayBtn.prop("title","Play")):(this.pausePlayBtn.removeClass(K),this.pausePlayBtn.addClass(L),this.pausePlayBtn.prop("title","Pause"))}function w(a){return!a.hasClass(Q)}function x(){var a=I(".spritzer-wpm-btn",this.container).text();return parseInt(a,10)}function y(a){var b={},c={debugLevel:0,redicleWidth:340,redicleHeight:70,defaultSpeed:250,speedItems:[250,300,350,400,450,500,550,600],controlButtons:["back","pauseplay","rewind"],header:{close:!1,closeHandler:""},controlTitles:{pause:"Pause",play:"Play",rewind:"Rewind",back:"Previous Sentence"},placeholderText:{startText:"Click to spritz.",startTextColor:"#bababa",endText:"",endTextColor:""},redicle:{lineStrokeWidth:.025,backgroundColor:"#ffffff",textNormalPaintColor:"#333",textHighlightPaintColor:"#cc0001",redicleLineColor:"#000",redicleLineWidth:1,countdownTime:750,countdownColor:"#e8e8e8",countdownSlice:5}};if("object"!=typeof a)b=c;else if(b=I.extend({},c,a),a&&a.redicle){var d=I.extend(!0,c.redicle,a.redicle);b.redicle=d}return b}function z(){this.spritzPanel.resetUser(),SpritzClient.userLogin(jsutil.createDelegate(this,function(){B.call(this,!0),u.call(this),v.call(this,!0)}),function(a){alert("Login failure ["+a+"]")})}function A(){this.spritzPanel.resetUser(),SpritzClient.userLogout(),B.call(this,!1),u.call(this),v.call(this,!0)}function B(a){I(".spritzer-login-btn").removeClass(a?"spritzer-isLoggedout":"spritzer-isLoggedin"),I(".spritzer-login-btn").addClass(a?"spritzer-isLoggedin":"spritzer-isLoggedout"),I(".spritzer-user-btn").removeClass(a?"spritzer-isLoggedin":"spritzer-isLoggedout"),I(".spritzer-user-btn").addClass(a?"spritzer-isLoggedout":"spritzer-isLoggedin"),I(".spritzer-user").text(a?SpritzClient.getUserName():"");var b=I(".spritzer-disabled");if(a&&b.length>0&&(I(".spritzer-disabled").removeClass("spritzer-disabled"),I(".spritzer-divider").hide()),!a){var c=this.getSpeed();(c>U||V>c)&&this.setSpeed(SPRITZ.spritzinc.SpritzOptions.defaultSpeed),I(".spritzer-divider").addClass("spritzer-disabled").show(),I(".spritzer-dropdown-speed li").each(function(){var a=I(this).data("value");(a>U||V>a)&&I(this).addClass("spritzer-disabled")})}}function C(a){var b='<div class="spritzer-header">';return b+='<a class="spritzer-logo" href="http://www.spritzinc.com" target="_blank"></a>',a.anonymousEnabled||(b+='<a class="spritzer-login-btn spritzer-isLoggedout">Login</a>',b+='<button type="button" class="spritzer-dropdown-toggle spritzer-user-btn" data-toggle="spritz-dropdown">',b+='<span class="spritzer-user"></span>',b+='<span class="spritzer-caret"></span>',b+='<div class="spritzer-up-caret-back"></div>',b+='<div class="spritzer-up-caret"></div>',b+="</button> ",b+='<ul class="spritzer-dropdown-menu" role="menu">',b+='<li><a class="spritzer-logout-btn">Logout</a></li>',b+="</ul>"),a.header.close&&(b+='<span class="spritzer-close">&#215</span>'),b+="</div>"}function D(a){var b="";return b+='<div class="spritzer-container">',b+=C(a),b+='<div id="spritzer-loading"></div>',b+='<div class="spritzer-preloaded spritzer-btn-pause"></div>',b+='<div class="spritzer-canvas-container">',b+='<canvas class="spritz-canvas" width="'+a.redicleWidth+'" height="'+a.redicleHeight+'"></canvas>',b+="</div>",b+='<div class="spritzer-controls-container">',a.speedItems.length>0&&(b+=F(a)),b+=E(a),b+="</div>",b+="</div>"}function E(a){var b="";b+='<div class="spritzer-preload spritzer-btn-pause">a</div>',b+='<div class="spritzer-button-container spritzer-btns-'+a.controlButtons.length+'">';for(var c=0,d=a.controlButtons.length;d>c;c+=1){var e=a.controlButtons[c],f=a.controlTitles[e];b+='<div class="spritzer-btn-'+e+'" title="'+f+'"></div>'}return b+="</div>"}function F(a){var b="",c=SpritzClient.isUserLoggedIn();b+='<div class="spritzer-speed" data-role="select">',b+='<button type="button" class="spritzer-dropdown-toggle spritzer-wpm-btn" data-toggle="spritz-dropdown">',b+='<span class="spritzer-wpm">'+a.defaultSpeed+' wpm </span><span class="spritzer-caret"></span>',b+="</button>",b+='<ul class="spritzer-dropdown-menu spritzer-dropdown-speed" role="menu">';for(var d=function(a){var b="";return c||(V>a||a>U)&&(b="spritzer-disabled"),b},e=SPRITZ.spritzinc.SpritzOptions.speedItems.sort(function(a,b){return a-b}),f=0,g=e.length;g>f;f+=1)b+='<li class="'+d(e[f])+'" data-value="'+e[f]+'">',b+='<a data-value="'+e[f]+'" href="#">'+e[f]+" wpm</a>",b+="</li>";return b+="</ul>",b+="</div>"}function G(a){var b=I('[data-role="spritzer"]');b.each(function(b,c){var d=I(c),e=d.data("options");"object"!=typeof e&&(e=null);var f=new SPRITZ.spritzinc.SpritzerController(e);f.spritzClient=a,f.attach(d)})}function H(a,b){var c=100*a,d=c/b;100>=b?t.call(this,d):100>c%b&&t.call(this,d)}var I=jQuery,J="spritzer-btn-",K=J+"play",L=J+"pause",M=J+"pauseplay",N=J+"rewind",O=J+"back",P=J+"forward",Q=J+"disabled",R="spritzer-close",S="spritzer",T="spritz-canvas",U=450,V=200;return a.prototype.getUnregisteredSpeeds=function(){return{maxUnregisteredSpeed:this.maxUnregisteredSpeed,minUnregisteredSpeed:this.minUnregisteredSpeed}},a.prototype.attach=function(a){this.parentContainer=a,a.hasClass(S)||a.addClass(S),this.container.appendTo(a),a.data("controller",this),null!==this.spritzClient&&this.hasSource()&&(v.call(this,!0),this.pausePlayBtn.removeClass(Q)),B.call(this,SpritzClient.isUserLoggedIn())},a.prototype.detach=function(){this.container.detach()},a.prototype.hasSource=function(){var a;if(null===this.spritzPanel.getCurrentText()){var b=this.parentContainer.data("url");a=null===b||"undefined"==typeof b||b.length>0}else a=!0;return a},a.prototype.loadText=function(a){var b;if(null===this.spritzClient||this.loading)b=!1;else{var e=this.parentContainer.data("url"),f=this.parentContainer.data("selector"),g=this.parentContainer.data("selectortype");(null===e||"undefined"==typeof e)&&(e=location.href),0==e.length?b=!1:(this.loading=!0,this.pausePlayBtn.addClass(Q),this.playOnFetchSuccess=a,I("#spritzer-loading").show(),this.spritzClient.fetchContents(e,jsutil.createDelegate(this,c),jsutil.createDelegate(this,d),f,g),b=!0)}return b},a.prototype.getSpritzText=function(){return this.spritzPanel.getCurrentText()},a.prototype.setSpritzText=function(a){null===a?(u.call(this,!1),null!=this.spritzClient&&this.hasSource()&&(v.call(this,!1),this.pausePlayBtn.removeClass(Q))):(null==a.getProgressTracker()&&a.setProgressTracker(this.progressReporter),this.spritzPanel.setCurrentText(a),this.spritzPanel.setOnCompleteCallback(jsutil.createDelegate(this,j)),u.call(this,!1))},a.prototype.getUrl=function(){return this.parentContainer.data("url")},a.prototype.setUrl=function(a,b,c){this.parentContainer.data("url")===a||(this.spritzPanel.resetText(),this.parentContainer.data("url",a),"number"==typeof b?(this.seekPosition=b,this.seekMode="undefined"==typeof c?SPRITZ.model.SpritzText.SeekType.SENTENCE_START:c===SPRITZ.model.SpritzText.SeekType.SENTENCE_START||c===SPRITZ.model.SpritzText.SeekType.ABSOLUTE?c:null):this.seekPosition=null,u.call(this,!1),null!==this.spritzClient&&this.hasSource()&&(v.call(this,!0),this.pausePlayBtn.removeClass(Q)))},a.prototype.startSpritzing=function(a){this.spritzPanel.pauseText(),null==a.getProgressTracker()&&a.setProgressTracker(this.progressReporter),this.spritzPanel.displayText(a,jsutil.createDelegate(this,j)),u.call(this,!0),v.call(this,!1)},a.prototype.stopSpritzing=function(){this.spritzPanel.resetText(),u.call(this),v.call(this,!0)},a.prototype.pauseSpritzing=function(){this.spritzPanel.pauseText(),v.call(this,!0)},a.prototype.resumeSpritzing=function(){this.spritzPanel.resumeText(),v.call(this,!1)},a.prototype.getSpeed=function(){return this.spritzPanel.getCurrentTextSpeed()},a.prototype.setSpeed=function(a){return"number"==typeof a?(a%1!==0&&(a=Math.round(a)),!SpritzClient.isUserLoggedIn()&&(a>U||V>a)?!1:(this.spritzPanel.setCurrentTextSpeed(a),this.speedDropdownController&&this.speedDropdownController.setValue(a,!0),!0)):(console.error("setSpeed accepts only numbers, you passed in: ",a,typeof a),!1)},a.prototype.getHighlightBestLetter=function(){return this.spritzPanel.getHighlightBestLetter()},a.prototype.setHighlightBestLetter=function(a){this.spritzPanel.setHighlightBestLetter(a)},a.prototype.getProgressReporter=function(){return this.progressReporter},a.prototype.setProgressReporter=function(a){this.progressReporter=a},a.prototype.seek=function(a,b){var c;return this.spritzPanel.seek(a,b)?(u.call(this),v.call(this,!0),c=!0):c=!1,c},a.prototype.setButtonEnabled=function(a,b){b?a.removeClass(Q):a.addClass(Q)},a.prototype.adjustButtonState=function(){u.call(this,this.spritzPanel.isRunning())},a.prototype.showSpritzer=function(){this.container.show()},a.prototype.hideSpritzer=function(){this.pauseSpritzing(),this.container.hide()},{SpritzerController:a,initSpritzers:G,adjustPausePlayButton:v}}),SPRITZ.namespace("SPRITZ.bookmark"),SPRITZ.addToNamespace(SPRITZ.bookmark,function(){function a(a){this.spritzerController=a,this.bookStores=null,this.currentBookStore=null,this.currentChapterName=null,this.options=null,b.call(this)}function b(a){this.options=C(a),this.bookStores=c.call(this,this.spritzerController)}function c(a){for(var b={},c=$(this.options.book),e=0,h=c.length;h>e;e+=1){var i=c[e],j=$(this.options.bookTitle,i),p=g($(this.options.bookName,j)),r=$(this.options.totalTime,j),s=$(this.options.remainingTime,j),t=new SPRITZ.bookmark.BookStore(p,f(r,s));b[p]=t,d.call(this,i,t);var u=a.parentContainer;u.on("onSpritzPause",jsutil.createDelegate(this,k)),u.on("onSpritzRewind",jsutil.createDelegate(this,n)),u.on("onSpritzBack",jsutil.createDelegate(this,l)),u.on("onSpritzForward",jsutil.createDelegate(this,m)),u.on("onSpritzComplete",jsutil.createDelegate(this,o)),u.on("onSpritzSpeedChange",jsutil.createDelegate(this,q))}return b}function d(a,b){for(var c=$(this.options.bookChapter,a),d=0,i=c.length;i>d;d+=1){var j=c[d],k=$(j).data("url"),l=$(j).data("selector"),m=$(this.options.statusImage,j),n=$(this.options.chapterName,j),o=g(n),p=$(this.options.totalTime,j),q=$(this.options.remainingTime,j),t=e(k,l),u=f(p,q,m,n);b.addChapter(o,t,u),h.call(this,b,o,t,u),$(m).on("click",{handler:b,name:o},jsutil.createDelegate(this,r)),$(n).on("click",{handler:b,name:o},jsutil.createDelegate(this,s))}}function e(a,b){return{url:a,selector:b}}function f(a,b,c,d){return{totalTime:a,remainingTime:b,bookmarkElement:c,chapterElement:d}}function g(a){var b=$(a).data("name");return("undefined"==typeof b||null===b||""===b)&&(b=a.text()),b}function h(a,b,c){var d=this,e=function(e){jsutil.debug(4,"BookController.onFetchInfoSuccess: "+e.getWordCount()+", "+e.getDuration()),c.text=e,v.call(d,a,b)},f=function(a){jsutil.debug(2,"BookController.onFetchInfoError: "+a.message)};SpritzClient.fetchContents2(c.url,e,f,{selector:c.selector,selectorType:"CSS",includePlainText:!1,includeSpritzableText:!1})}function i(a,b,c){var d=function(d){jsutil.debug(4,"BookController.fetchTextAndStartSpritzing"),c.text=d,j.call(this,a,b,c)},e=function(a){jsutil.debug(2,"BookController.fetchTextAndStartSpritzing: "+a.message)};SpritzClient.fetchContentsByContentId(c.text.contentId,jsutil.createDelegate(this,d),e)}function j(a,b,c){null!=this.currentBookStore&&null!=this.currentChapterName&&$(this.currentBookStore.getControls(this.currentChapterName).chapterElement).removeClass(this.options.textHighlighter),$(a.getControls(b).chapterElement).addClass(this.options.textHighlighter),this.currentBookStore=a,this.currentChapterName=b;var d=c.text.clone(),e=a.getPosition(b);null!==e&&d.setCurrentIndex(e),d.hasNextWord()?this.spritzerController.startSpritzing(d):this.spritzerController.setSpritzText(d)}function k(a,b){p.call(this,b)}function l(a,b){p.call(this,b)}function m(a,b){p.call(this,b)}function n(a,b){p.call(this,b)}function o(){this.currentBookStore.setCompleted(this.currentChapterName),v.call(this,this.currentBookStore,this.currentChapterName)}function p(a){this.currentBookStore.setPosition(this.currentChapterName,a),v.call(this,this.currentBookStore,this.currentChapterName)}function q(a,b){jsutil.debug(4,"BookController.onSpeedChange");for(var c in this.bookStores){var d=this.bookStores[c];w(this.bookStores[c],b);for(var e in d.getChapters())x(d,e,b)}}function r(a){jsutil.debug(4,"BookController.onBookmarkClick"),t.call(this,a.data.handler,a.data.name,a.data.handler.getContent(a.data.name))}function s(a){jsutil.debug(4,"BookController.onChapterClick"),t.call(this,a.data.handler,a.data.name,a.data.handler.getContent(a.data.name))}function t(a,b,c){var d=this;if(jsutil.debug(4,"BookController.handleContentClick"),"undefined"==typeof c.text){var e=function(e){jsutil.debug(4,"BookController.handleContentClick"),c.text=e,v.call(d,a,b)},f=function(a){jsutil.debug(2,"BookController.handleContentClick: "+a.message)};SpritzClient.fetchContents(c.url,e,f,c.selector)}else c.text.isLoaded()?j.call(this,a,b,c):i.call(this,a,b,c)}function u(){return speed=this.spritzerController.getSpeed(),0>=speed&&(speed=250),speed}function v(a,b){var c=u.call(this);w(a,c),x(a,b,c),A.call(this,a,b),B.call(this,a,b)}function w(a,b){y(a.controls.totalTime,SPRITZ.utils.timeToString(a.getTotalTotalTime(b))),y(a.controls.remainingTime,SPRITZ.utils.timeToString(a.getTotalRemainingTime(b)))}function x(a,b,c){var d=a.getControls(b),e=SPRITZ.utils.timeToString(a.getTotalTime(b,c));y(d.totalTime,e),z(d.chapterElement,"Total Time: "+e);var f=SPRITZ.utils.timeToString(a.getRemainingTime(b,c));y(d.remainingTime,f),z(d.bookmarkElement,"Remaining Time: "+f)}function y(a,b){null!==a&&$(a).text(b)}function z(a,b){null!==a&&$(a).prop("title",b)}function A(a,b){a.hasBookmark(b)?$(a.getControls(b).bookmarkElement).addClass(this.options.bookmarkImage):$(a.getControls(b).bookmarkElement).removeClass(this.options.bookmarkImage)}function B(a,b){var c=a.getControls(b);a.isCompleted(b)?($(c.bookmarkElement).addClass(this.options.checkmarkImage),$(c.chapterElement).addClass(this.options.chapterCompleted),$(c.totalTime).addClass(this.options.chapterCompleted),$(c.remainingTime).addClass(this.options.chapterCompleted)):($(c.bookmarkElement).removeClass(this.options.checkmarkImage),$(c.chapterElement).removeClass(this.options.chapterCompleted),$(c.totalTime).removeClass(this.options.chapterCompleted),$(c.remainingTime).removeClass(this.options.chapterCompleted))}function C(a){var b={},c={book:".spritz-book",bookTitle:".book-title",bookChapter:".book-chapter",bookName:".book-name",totalTime:".total-time",remainingTime:".remaining-time",statusImage:".status-image",chapterName:".chapter-name",bookmarkImage:"bookmark-image",checkmarkImage:"checkmark-image",chapterCompleted:"chapter-completed",textHighlighter:"text-highlighter"};return b="object"==typeof a?$.extend({},c,a):c}return{BookController:a}}),SPRITZ.addToNamespace(SPRITZ.bookmark,function(){function a(){var a=localStorage.getItem(this.storageKey);this.bookmarkData=null!==a&&"undefined"!=typeof a?JSON.parse(a):null}function b(){localStorage.setItem(this.storageKey,JSON.stringify(this.bookmarkData))}function c(){var a={};return a.createTime=(new Date).getTime(),a.updateTime=null,a.chapterPositions={},a}var d=function(b,c){this.bookmarkData=null,this.controls=c,this.storageKey="spritz.bookmark."+b,this.chapters={},a.call(this)};return d.prototype.addChapter=function(a,b,c){this.chapters[a]={content:b,controls:c}
},d.prototype.getChapters=function(){return this.chapters},d.prototype.getContent=function(a){return this.chapters[a].content},d.prototype.getControls=function(a){return this.chapters[a].controls},d.prototype.getPosition=function(a){var b=null;return null!=this.bookmarkData&&(b=this.bookmarkData.chapterPositions[a],"undefined"==typeof b&&(b=0)),b},d.prototype.setPosition=function(a,d){null==this.bookmarkData&&(this.bookmarkData=c()),this.bookmarkData.updateTime=(new Date).getTime(),this.bookmarkData.chapterPositions[a]=d,b.call(this)},d.prototype.isCompleted=function(a){var b=this.getContent(a).text;return null!==b&&b.getWordCount()>0&&this.getPosition(a)>=b.getWordCount()},d.prototype.setCompleted=function(a){this.setPosition(a,this.getContent(a).text.getWordCount())},d.prototype.hasBookmark=function(a){var b=this.getPosition(a),c=this.getContent(a);return b>0&&b<c.text.getWordCount()},d.prototype.getTotalTime=function(a,b){var c=0,d=this.getContent(a);if(null!==d){var e=d.text;null!==e&&"undefined"!=typeof e&&(c=e.getTotalTime(b))}return c},d.prototype.getTotalTotalTime=function(a){var b=0;for(chapterName in this.chapters)b+=this.getTotalTime(chapterName,a);return b},d.prototype.getRemainingTime=function(a,b){var c=0,d=this.getContent(a);if(null!==d){var e=d.text;null!==e&&"undefined"!=typeof e&&(c=this.isCompleted(a)?0:e.calculateTime(b,this.getPosition(a)))}return c},d.prototype.getTotalRemainingTime=function(a){var b=0;for(chapterName in this.chapters)b+=this.getRemainingTime(chapterName,a);return b},d.prototype.removeBookmarks=function(){localStorage.removeItem(storageKey),this.bookmarkData=null},{BookStore:d}});var goog={};goog.math={},goog.math.Long=function(a,b){this.low_=0|a,this.high_=0|b},goog.math.Long.IntCache_={},goog.math.Long.fromInt=function(a){if(a>=-128&&128>a){var b=goog.math.Long.IntCache_[a];if(b)return b}var c=new goog.math.Long(0|a,0>a?-1:0);return a>=-128&&128>a&&(goog.math.Long.IntCache_[a]=c),c},goog.math.Long.fromNumber=function(a){return isNaN(a)||!isFinite(a)?goog.math.Long.ZERO:a<=-goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MIN_VALUE:a+1>=goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MAX_VALUE:0>a?goog.math.Long.fromNumber(-a).negate():new goog.math.Long(a%goog.math.Long.TWO_PWR_32_DBL_|0,a/goog.math.Long.TWO_PWR_32_DBL_|0)},goog.math.Long.fromBits=function(a,b){return new goog.math.Long(a,b)},goog.math.Long.fromString=function(a,b){if(0==a.length)throw Error("number format error: empty string");var c=b||10;if(2>c||c>36)throw Error("radix out of range: "+c);if("-"==a.charAt(0))return goog.math.Long.fromString(a.substring(1),c).negate();if(a.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+a);for(var d=goog.math.Long.fromNumber(Math.pow(c,8)),e=goog.math.Long.ZERO,f=0;f<a.length;f+=8){var g=Math.min(8,a.length-f),h=parseInt(a.substring(f,f+g),c);if(8>g){var i=goog.math.Long.fromNumber(Math.pow(c,g));e=e.multiply(i).add(goog.math.Long.fromNumber(h))}else e=e.multiply(d),e=e.add(goog.math.Long.fromNumber(h))}return e},goog.math.Long.TWO_PWR_16_DBL_=65536,goog.math.Long.TWO_PWR_24_DBL_=1<<24,goog.math.Long.TWO_PWR_32_DBL_=goog.math.Long.TWO_PWR_16_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_31_DBL_=goog.math.Long.TWO_PWR_32_DBL_/2,goog.math.Long.TWO_PWR_48_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_64_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_32_DBL_,goog.math.Long.TWO_PWR_63_DBL_=goog.math.Long.TWO_PWR_64_DBL_/2,goog.math.Long.ZERO=goog.math.Long.fromInt(0),goog.math.Long.ONE=goog.math.Long.fromInt(1),goog.math.Long.NEG_ONE=goog.math.Long.fromInt(-1),goog.math.Long.MAX_VALUE=goog.math.Long.fromBits(-1,2147483647),goog.math.Long.MIN_VALUE=goog.math.Long.fromBits(0,-2147483648),goog.math.Long.TWO_PWR_24_=goog.math.Long.fromInt(1<<24),goog.math.Long.prototype.toInt=function(){return this.low_},goog.math.Long.prototype.toNumber=function(){return this.high_*goog.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},goog.math.Long.prototype.toString=function(a){var b=a||10;if(2>b||b>36)throw Error("radix out of range: "+b);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){var c=goog.math.Long.fromNumber(b),d=this.div(c),e=d.multiply(c).subtract(this);return d.toString(b)+e.toInt().toString(b)}return"-"+this.negate().toString(b)}for(var f=goog.math.Long.fromNumber(Math.pow(b,6)),e=this,g="";;){var h=e.div(f),i=e.subtract(h.multiply(f)).toInt(),j=i.toString(b);if(e=h,e.isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},goog.math.Long.prototype.getHighBits=function(){return this.high_},goog.math.Long.prototype.getLowBits=function(){return this.low_},goog.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:goog.math.Long.TWO_PWR_32_DBL_+this.low_},goog.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(goog.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var a=0!=this.high_?this.high_:this.low_,b=31;b>0&&0==(a&1<<b);b--);return 0!=this.high_?b+33:b+1},goog.math.Long.prototype.isZero=function(){return 0==this.high_&&0==this.low_},goog.math.Long.prototype.isNegative=function(){return this.high_<0},goog.math.Long.prototype.isOdd=function(){return 1==(1&this.low_)},goog.math.Long.prototype.equals=function(a){return this.high_==a.high_&&this.low_==a.low_},goog.math.Long.prototype.notEquals=function(a){return this.high_!=a.high_||this.low_!=a.low_},goog.math.Long.prototype.lessThan=function(a){return this.compare(a)<0},goog.math.Long.prototype.lessThanOrEqual=function(a){return this.compare(a)<=0},goog.math.Long.prototype.greaterThan=function(a){return this.compare(a)>0},goog.math.Long.prototype.greaterThanOrEqual=function(a){return this.compare(a)>=0},goog.math.Long.prototype.compare=function(a){if(this.equals(a))return 0;var b=this.isNegative(),c=a.isNegative();return b&&!c?-1:!b&&c?1:this.subtract(a).isNegative()?-1:1},goog.math.Long.prototype.negate=function(){return this.equals(goog.math.Long.MIN_VALUE)?goog.math.Long.MIN_VALUE:this.not().add(goog.math.Long.ONE)},goog.math.Long.prototype.add=function(a){var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,l=0,m=0;return m+=e+i,l+=m>>>16,m&=65535,l+=d+h,k+=l>>>16,l&=65535,k+=c+g,j+=k>>>16,k&=65535,j+=b+f,j&=65535,goog.math.Long.fromBits(l<<16|m,j<<16|k)},goog.math.Long.prototype.subtract=function(a){return this.add(a.negate())},goog.math.Long.prototype.multiply=function(a){if(this.isZero())return goog.math.Long.ZERO;if(a.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE))return a.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(a.equals(goog.math.Long.MIN_VALUE))return this.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().multiply(a.negate()):this.negate().multiply(a).negate();if(a.isNegative())return this.multiply(a.negate()).negate();if(this.lessThan(goog.math.Long.TWO_PWR_24_)&&a.lessThan(goog.math.Long.TWO_PWR_24_))return goog.math.Long.fromNumber(this.toNumber()*a.toNumber());var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,l=0,m=0;return m+=e*i,l+=m>>>16,m&=65535,l+=d*i,k+=l>>>16,l&=65535,l+=e*h,k+=l>>>16,l&=65535,k+=c*i,j+=k>>>16,k&=65535,k+=d*h,j+=k>>>16,k&=65535,k+=e*g,j+=k>>>16,k&=65535,j+=b*i+c*h+d*g+e*f,j&=65535,goog.math.Long.fromBits(l<<16|m,j<<16|k)},goog.math.Long.prototype.div=function(a){if(a.isZero())throw Error("division by zero");if(this.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE)){if(a.equals(goog.math.Long.ONE)||a.equals(goog.math.Long.NEG_ONE))return goog.math.Long.MIN_VALUE;if(a.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ONE;var b=this.shiftRight(1),c=b.div(a).shiftLeft(1);if(c.equals(goog.math.Long.ZERO))return a.isNegative()?goog.math.Long.ONE:goog.math.Long.NEG_ONE;var d=this.subtract(a.multiply(c)),e=c.add(d.div(a));return e}if(a.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().div(a.negate()):this.negate().div(a).negate();if(a.isNegative())return this.div(a.negate()).negate();for(var f=goog.math.Long.ZERO,d=this;d.greaterThanOrEqual(a);){for(var c=Math.max(1,Math.floor(d.toNumber()/a.toNumber())),g=Math.ceil(Math.log(c)/Math.LN2),h=48>=g?1:Math.pow(2,g-48),i=goog.math.Long.fromNumber(c),j=i.multiply(a);j.isNegative()||j.greaterThan(d);)c-=h,i=goog.math.Long.fromNumber(c),j=i.multiply(a);i.isZero()&&(i=goog.math.Long.ONE),f=f.add(i),d=d.subtract(j)}return f},goog.math.Long.prototype.modulo=function(a){return this.subtract(this.div(a).multiply(a))},goog.math.Long.prototype.not=function(){return goog.math.Long.fromBits(~this.low_,~this.high_)},goog.math.Long.prototype.and=function(a){return goog.math.Long.fromBits(this.low_&a.low_,this.high_&a.high_)},goog.math.Long.prototype.or=function(a){return goog.math.Long.fromBits(this.low_|a.low_,this.high_|a.high_)},goog.math.Long.prototype.xor=function(a){return goog.math.Long.fromBits(this.low_^a.low_,this.high_^a.high_)},goog.math.Long.prototype.shiftLeft=function(a){if(a&=63,0==a)return this;var b=this.low_;if(32>a){var c=this.high_;return goog.math.Long.fromBits(b<<a,c<<a|b>>>32-a)}return goog.math.Long.fromBits(0,b<<a-32)},goog.math.Long.prototype.shiftRight=function(a){if(a&=63,0==a)return this;var b=this.high_;if(32>a){var c=this.low_;return goog.math.Long.fromBits(c>>>a|b<<32-a,b>>a)}return goog.math.Long.fromBits(b>>a-32,b>=0?0:-1)},goog.math.Long.prototype.shiftRightUnsigned=function(a){if(a&=63,0==a)return this;var b=this.high_;if(32>a){var c=this.low_;return goog.math.Long.fromBits(c>>>a|b<<32-a,b>>>a)}return 32==a?goog.math.Long.fromBits(b,0):goog.math.Long.fromBits(b>>>a-32,0)},jQuery(document).trigger("spritz_loaded_internal"),jQuery(document).trigger("spritz_loaded");